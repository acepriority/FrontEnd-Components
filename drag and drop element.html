<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Document</title>
</head>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        background-color: #f4f4f4;
    }

    .wrapper, .drag-area, .cancel-btn, .file-info {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .img-area{
        display: flex;
        gap: 1rem;
    }

    .img-and-btn {
        display: flex;
        justify-content: space-between;
    }

    .wrapper {
        margin: 1rem;
    }

    .drag-area {
        width: 50%;
        aspect-ratio: 1 / 0.3;
    }
    
    .drag-area {
        padding: 1rem;
        border: 2px dashed #ccc;
        border-radius: 16px;
        text-align: center;
        background-color: #f4f4f4;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }
    
    .drag-area.hover {
        background-color: #f0f8ff;
    }
    
    .area-heading h3, .area-sub-heading h4, .file-info p {
        margin: 0;
        padding: 0;
    }

    .area-sub-heading h4 {
        color: #6a6a6a;
        font-weight: normal;
        margin-bottom: 1rem;
    }

    .area-heading {
        margin-bottom: 2rem;
    }

    .preview-area {
        margin: 1rem;
    }
    
    #image-preview {
        max-width: 100px;
        max-height: 50px;
        border-radius: 8px;
        opacity: 0.5;
        transition: opacity 0.3s;
    }    

    .progress-bar-container {
        width: 100%;
        height: 8px;
        background-color: #f3f3f3;
        border-radius: 10px;
        margin-top: 20px;
        border: 1px solid #ccc;
      }
      
      .progress-bar {
        width: 0%;
        height: 100%;
        background-color: #0046ff;
        border-radius: 10px;
        transition: width 0.3s;
      }

      .cancel-btn {
        display: none;
        background-color: #f4f4f4;
        width: 60px;
        height: 60px;
        border-radius: 50%;
    }
    
    .cancel-button {
        position: relative;
        background: none;
        border: none;
        cursor: pointer;
        display: none;
    }

    .file-info {
        margin-top: 10px;
        text-align: center;
        font-size: 14px;
        color: #555;
    }
    
    #file-name {
        font-weight: bold;
    }
    
    #file-size {
        font-weight: normal;
        color: #777;
    }

    .scan-button {
        display: none;
        margin-top: 1rem;
        border: none;
        background-color: #0046ff;
        color: #ffff;
        border-radius: 8px;
        padding: 5px 15px;
        cursor: pointer;
    }
</style>
<body>
    <div class="wrapper">
        <div class="drag-area" id="drag-area">
            <div class="upload-icon">
                <span class="material-symbols-outlined">
                    upload_file
                </span>
            </div>
            <div class="drag-area-text">
                <div class="area-heading">
                    <h3>Create or Import a custom classification</h3>
                </div>
                <div class="area-sub-heading">
                    <h4>Maximum file size: 50 MB</h4>
                    <h4>Supported format: .JPEG/.JPG/.PNG/.SVG</h4>
                </div>
            </div>
            <input type="file" id="file-input" hidden>
        </div>

        <div class="preview-area" id="preview-area">
            <div class="img-and-btn">
                <div class="img-area">
                    <img id="image-preview" src="" alt="Image Preview" style="display:none;">
                    <div class="file-info" id="file-info" style="display:none;">
                        <p id="file-name"></p>
                        <p id="file-size"></p>
                    </div>
                </div>
                <div class="cancel-btn" id="cancel-button">
                    <button class="cancel-button" id="cancel-button-icon">
                        <span class="material-symbols-outlined">
                            close
                        </span>
                    </button>
                </div>
            </div>

            <div class="progress-bar-container" id="progress-bar-container" style="display:none;">
                <div class="progress-bar" id="progress-bar"></div>
            </div>

            <div class="submit-button">
                <button class="scan-button" id="scan-button">scan</button>
            </div>
        </div>
    </div>
</body>
<script>
    const dragArea = document.getElementById("drag-area");
    const fileInput = document.getElementById("file-input");
    const previewArea = document.getElementById("preview-area");
    const imagePreview = document.getElementById("image-preview");
    const progressBarContainer = document.getElementById("progress-bar-container");
    const progressBar = document.getElementById("progress-bar");
    const cancelButton = document.getElementById("cancel-button");
    const cancelButtonIcon = document.getElementById("cancel-button-icon");
    const scanButton = document.getElementById("scan-button");

    const fileNameElement = document.getElementById("file-name");
    const fileSizeElement = document.getElementById("file-size");
    const fileInfo = document.getElementById("file-info");

    let uploadInterval = null; // To track the interval for the simulated upload
    let isUploadCancelled = false; // Track if the upload was cancelled

    dragArea.addEventListener("dragover", (e) => {
      e.preventDefault();
      dragArea.classList.add("hover");
    });

    dragArea.addEventListener("dragleave", () => {
      dragArea.classList.remove("hover");
    });

    dragArea.addEventListener("drop", (e) => {
      e.preventDefault();
      dragArea.classList.remove("hover");

      const files = e.dataTransfer.files;
      if (files.length) {
        handleFiles(files);
      }
    });

    dragArea.addEventListener("click", () => {
      fileInput.click();
    });

    fileInput.addEventListener("change", () => {
      const files = fileInput.files;
      if (files.length) {
        handleFiles(files);
      }
    });

    cancelButton.addEventListener("click", () => {
      cancelUpload();
    });

    function handleFiles(files) {
      const file = files[0];
      if (file.type.startsWith("image/")) {
        stylePreviewArea();
        previewArea.style.display = "block";
        showProgressBar(true);
        previewImage(file);  // Display the faint image immediately
        simulateUpload(file);

        // Display file name and size
        fileNameElement.textContent = `${file.name}`;
        fileSizeElement.textContent = `${formatFileSize(file.size)}`;
        fileInfo.style.display = "block"; // Show the file info
      } else {
        alert("Please upload an image file.");
      }
    }

    function formatFileSize(bytes) {
        const sizes = ["Bytes", "KB", "MB", "GB", "TB"];
        if (bytes === 0) return "0 Bytes";
        const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
        return Math.round(bytes / Math.pow(1024, i), 2) + " " + sizes[i];
    }

    function simulateUpload(file) {
      let progress = 0;
      isUploadCancelled = false;
      cancelButton.style.display = "block";
      cancelButtonIcon.style.display = "block";
      uploadInterval = setInterval(() => {
        if (isUploadCancelled) {
          clearInterval(uploadInterval);
          resetUpload();
          return;
        }

        progress += 10;
        updateProgressBar(progress);

        if (progress >= 100) {
          clearInterval(uploadInterval);
          showProgressBar(true);
          progressBar.style.width = "100%";
          imagePreview.style.opacity = 1;
          scanButton.style.display = "block";
        }
      }, 300);
    }

    function updateProgressBar(value) {
      progressBar.style.width = `${value}%`;
    }

    function previewImage(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        imagePreview.src = e.target.result;
        imagePreview.style.display = "block";
        imagePreview.style.opacity = 0.5;
      };
      reader.readAsDataURL(file);
    }

    function showProgressBar(show) {
      if (show) {
        progressBarContainer.style.display = "block";
        progressBar.style.width = "0%";
      } else {
        progressBarContainer.style.display = "none";
      }
    }

    cancelButton.addEventListener("click", () => {
        if (progressBar.style.width !== "100%") {
          // If the upload is still in progress, cancel the upload
          cancelUpload();
        } else {
          // If the upload is completed, reset everything
          resetUpload();
        }
      });
      
      function cancelUpload() {
        isUploadCancelled = true; // Flag the upload as cancelled
      }
      
      function resetUpload() {
        progressBar.style.width = "0%";
        imagePreview.style.display = "none";
        fileInfo.style.display = "none";
        cancelButton.style.display = "none";
        scanButton.style.display = "none";
        showProgressBar(false);
        previewArea.style.display = "none";
      }

    function stylePreviewArea() {
        previewArea.style.border = "2px solid #ccc";
        previewArea.style.borderRadius = "16px";
        previewArea.style.backgroundColor = "#f4f4f4";
        previewArea.style.padding = "1rem";
        previewArea.style.width = "50%";
        previewArea.style.aspectRatio = "1 / 0.1"
    }
</script>
</html>